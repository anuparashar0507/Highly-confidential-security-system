$(function(){var a=$("#eg-main-wrapper"),b=$("#eg-top"),c=function(){var c=-1,d=false,e=a.find("div.eg-main > a"),f=a.find(".eg-image"),g=f.length,h=function(){a.find(".eg-video").append('<span class="eg-icon eg-video-icon">');i()},i=function(){e.addClass("shown");var c=Math.floor($(window).width()/e.outerWidth(true));if($(".shown").length<c){a.find("div.eg-main").width($(".shown").length*e.outerWidth(true))}else{a.find("div.eg-main").width(c*e.outerWidth(true)).height(Math.ceil($(".shown").length/c)*e.outerHeight(true))}a.width($(window).width()).height($(window).height()-b.height());$("span.eg-nav a").click(function(){var b=$(this).attr("href").replace("#","");if(b=="all"){$(".hidden").addClass("shown").removeClass("hidden").show()}else{e.removeClass("shown").addClass("hidden");e.each(function(){if($(this).attr("rel")==b){$(this).addClass("shown").removeClass("hidden")}});$(".hidden").hide();if($(".shown").length<Math.floor($(window).width()/e.outerWidth(true))){a.find("div.eg-main").width($(".shown").length*e.outerWidth(true))}$(".shown").show()}$(window).resize();return false});e.bind("click.egTemplate",function(a){a.preventDefault();j($(this));return false});$(window).bind("resize.egTemplate",function(c){var d=Math.floor($(window).width()/e.outerWidth(true));if($(".shown").length<d){a.find("div.eg-main").width($(".shown").length*e.outerWidth(true))}else{a.find("div.eg-main").width(d*e.outerWidth(true)).height(Math.ceil($(".shown").length/d)*e.outerHeight(true))}a.width($(window).width()).height($(window).height()-b.height());$("#eg-img-preview, #eg-content-preview, #eg-video-preview").css({width:$(window).width(),height:$(window).height()})})},j=function(b){if(d)return false;if(b.hasClass("eg-content")){d=true;c=b.index(".eg-content.shown");l(b,function(){d=false})}else if(b.hasClass("eg-video")){d=true;c=b.index(".eg-video.shown");m(b,function(){d=false})}else if(b.hasClass("eg-image")){g=a.find(".eg-image.shown").length;d=true;c=b.index(".eg-image.shown");k(b,function(){d=false})}else{window.location=b.attr("href")}},k=function(b,c){var d=b.children("img").data("largesrc"),e=b.children("span").html(),f={src:d,description:e};b.addClass("eg-loading");n(d,function(){b.removeClass("eg-loading");var h=$("#eg-img-preview").length>0;if(!h)$("#previewTmpl").tmpl(f).insertAfter(a);else $("#eg-img-preview").children("img.eg-preview-img").attr("src",d).end().find("span.eg-preview-descr").html(e);var i=v(0,0,d);b.removeClass("eg-img-loading");$("#eg-img-preview").css({width:b.width(),height:b.height(),left:b.offset().left,top:b.offset().top}).children("img.eg-preview-img").hide().css({width:i.width,height:i.height,left:i.left,top:i.top}).fadeIn(400).end().show().animate({width:$(window).width(),left:0},500,"easeOutExpo",function(){$(this).animate({height:$(window).height(),top:0},400,function(){var a=$(this);a.find("span.eg-preview-descr, span.eg-close").show();if(g>1)a.find("div.eg-nav").show();if(c)c.call()})});if(!h)o()})},l=function(b,c){var d=$("#eg-content-preview").length>0,e=b.children("div.eg-title").html(),f=b.children("div.eg-content-full").html(),g={title:e,content:f};if(!d)$("#contentTmpl").tmpl(g).insertAfter(a);$("#eg-content-preview").css({width:b.width(),height:b.height(),left:b.offset().left,top:b.offset().top}).show().animate({width:$(window).width(),left:0},500,"easeOutExpo",function(){$(this).animate({height:$(window).height(),top:0},400,function(){var a=$(this),b=a.find("div.eg-title"),g=a.find("div.eg-content-full"),h=a.find("span.eg-close");if(d){b.html(e);g.html(f)}b.show();g.show();h.show();if(c)c.call()})});if(!d)p()},m=function(b,c){var d=$("#eg-video-preview").length>0,e=b.attr("href"),f={src:e};if(!d)$("#videoTmpl").tmpl(f).insertAfter(a);$("#eg-video-preview").css({width:b.width(),height:b.height(),left:b.offset().left,top:b.offset().top}).show().animate({width:$(window).width(),left:0},500,"easeOutExpo",function(){$(this).animate({height:$(window).height(),top:0},400,function(){var a=$(this),f=a.find(".eg-video-full"),g=a.find("span.eg-close");if(d){f.attr("src",e)}var h=b.data("vidwidth"),i=b.data("vidheight"),j=v($(window).width(),$(window).height(),false);f.removeAttr("height").removeAttr("width");$(".eg-video-full").attr("height",j.height);$(".eg-video-full").attr("width",j.width);f.css({width:j.width,height:j.height,left:j.left,top:j.top}).show();g.show();if(c)c.call()})});if(!d)q()},n=function(a,b){$("<img/>").load(function(){if(b)b.call()}).attr("src",a)},o=function(){var a=$("#eg-img-preview");a.find("span.eg-nav-prev").bind("click.egTemplate",function(a){r("prev")}).end().find("span.eg-nav-next").bind("click.egTemplate",function(a){r("next")}).end().find("span.eg-close").bind("click.egTemplate",function(a){s()});$(window).bind("resize.egTemplate",function(b){var c=a.children("img.eg-preview-img"),d=v(0,0,c.attr("src"));c.css({width:d.width,height:d.height,left:d.left,top:d.top})})},p=function(){$("#eg-content-preview").find("span.eg-close").bind("click.egTemplate",function(a){t()})},q=function(){$("#eg-video-preview").find("span.eg-close").bind("click.egTemplate",function(a){u()});$(window).bind("resize.egTemplate",function(a){var b=v($(window).width(),$(window).height(),false);$(".eg-video-full").contents().find("object, embed").height(b.height).attr("height",b.height);$(".eg-video-full").contents().find("object, embed").width(b.width).attr("width",b.width);$("#eg-video-preview").children(".eg-video-full").css({width:b.width,height:b.height,left:b.left,top:b.top})})},r=function(b){if(d)return false;d=true;var e=$("#eg-img-preview"),f=e.find("div.eg-loading-large");f.show();if(b==="next"){c===g-1?c=0:++c}else if(b==="prev"){c===0?c=g-1:--c}var h=a.find(".eg-image.shown").eq(c),i=h.children("img").data("largesrc"),j=h.children("span").text();n(i,function(){f.hide();var b=v(0,0,i);e.children("img.eg-preview-img").attr("src",i).css({width:b.width,height:b.height,left:b.left,top:b.top}).end().find("span.eg-preview-descr").text(j);a.scrollTop(h.offset().top).scrollLeft(h.offset().left);d=false})},s=function(){if(d)return false;d=true;var a=f.eq(c);$("#eg-img-preview").find("span.eg-preview-descr, div.eg-nav, span.eg-close").hide().end().animate({height:a.height(),top:a.offset().top},500,"easeOutExpo",function(){$(this).animate({width:a.width(),left:a.offset().left},400,function(){$(this).fadeOut(function(){d=false})})})},t=function(){if(d)return false;d=true;var b=a.find(".eg-content").eq(c);$("#eg-content-preview").find("div.eg-title, div.eg-content-full, span.eg-close").hide().end().animate({height:b.height(),top:b.offset().top},500,"easeOutExpo",function(){$(this).animate({width:b.width(),left:b.offset().left},400,function(){$(this).fadeOut(function(){d=false})})})},u=function(){if(d)return false;d=true;var b=a.find(".eg-video").eq(c);$(".eg-video-full").attr("src","");$("#eg-video-preview").find(".eg-video-full, span.eg-close").hide().end().animate({height:b.height(),top:b.offset().top},500,"easeOutExpo",function(){$(this).animate({width:b.width(),left:b.offset().left},400,function(){$(this).fadeOut(function(){d=false})})})},v=function(a,b,c){if(c){var d=new Image;d.src=c;var e=d.width,f=d.height}else{var e=a,f=b}var g=$(window).width(),h=$(window).height(),i=h/g,j=f/e,k,l,m,n;if(i>j){l=h;k=h/j}else{l=g*j;k=g}return{width:k,height:l,left:(g-k)/2,top:(h-l)/2}};return{init:h}}();c.init()})